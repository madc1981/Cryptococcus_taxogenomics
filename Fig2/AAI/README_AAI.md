# AAI Analysis Pipeline

This subfolder contains the script and instructions used to calculate average amino acid identity (AAI) to support Figure 2 of the manuscript.

## Overview

This pipeline uses the [EzAAI](https://github.com/endixk/ezaai) tool to:

1. Convert annotated protein FASTA files (\*.proteins.fa) into EzAAI-formatted databases.
2. Compute pairwise AAI values using user-specified tools and thresholds.

Dendrogram generation is excluded in this implementation to preserve accurate interpretability of distance values.

## File List

```
AAI/
├── 0_run_ezaai_pipeline.sh         # Main script for AAI analysis
├── 1_plot_aai_dendrogram.py        # Optional: generates AAI dendrogram and Newick tree
├── 2_compute_aai_stats.py          # Computes min/max/mean AAI between clades or strains
├── README.md
```

## Requirements

- Bash
- Conda environment named `ezaai_env` containing:
  - EzAAI
  - MMseqs2, DIAMOND, or BLAST+
- Protein files: one `*.proteins.fa` file per genome

## Installation

Follow installation instructions from the EzAAI GitHub repository: [https://github.com/endixk/ezaai](https://github.com/endixk/ezaai)

## Usage

From within the directory containing all `*.proteins.fa` files:

```bash
bash 0_run_ezaai_pipeline.sh [PROGRAM] [IDENTITY] [COVERAGE] [PREFIX]
```

### Parameters:

- `PROGRAM`: Tool to use for pairwise comparisons (`mmseqs`, `diamond`, or `blastp`)
- `IDENTITY`: Minimum sequence identity threshold (e.g., `0.3`)
- `COVERAGE`: Minimum alignment coverage threshold (e.g., `0.5`)
- `PREFIX`: Optional prefix for the output file (default: `aai`)

### Example:

```bash
bash 0_run_ezaai_pipeline.sh diamond 0.4 0.5 Cryptococcus
```

This will generate an output file named:

```
Cryptococcus_diamond_id0.4_cov0.5.tsv
```

### Outputs:

- `aai_<program>_id<identity>_cov<coverage>.tsv`: AAI matrix generated by EzAAI
- `*_dendrogram_aai.pdf` *(optional)*: Dendrogram generated by `1_plot_aai_dendrogram.py`
- `*_tree_aai.nwk` *(optional)*: Newick tree generated by `1_plot_aai_dendrogram.py`
- `*_aai_pairwise_stats.csv` or `*_aai_pairwise_stats_by_clade.csv`: Summary stats from `2_compute_aai_stats.py`

All intermediate `.db` files are stored in the `db/` directory. Temporary files are stored in the `tmp/` directory.

## Citation

If you use EzAAI in your research, please cite:

- Kim D, Park S, Chun J. *Introducing EzAAI: a pipeline for high throughput calculations of prokaryotic average amino acid identity.* J Microbiol. 2021 May;59(5):476–480. doi: 10.1007/s12275-021-1154-0. PMID: 33907973.

If you use this AAI analysis pipeline and accompanying scripts, please cite:

- Coelho et al. 2025. *Genomic and phenotypic insights into the expanding phylogenetic landscape of the Cryptococcus genus* (in preparation).

## License

The script is released under the MIT License.

---

For questions or issues, please contact: marco.dias.coelho [at] duke.edu

